# 2026-01-30 - Session Log

## Critical Lesson Learned: AI Needs Rich Data

**User's Key Point:** "We need to make sure the AI gets as much ammo for the report. So we can give accurate results and speak to it. Remember all of this before you start forgetting."

### The Data Pipeline Problem

Reports were coming out GENERIC instead of PERSONALIZED because:
- Research script returning incomplete data (0 attorneys, low confidence)
- AI analyzer had nothing to work with
- Report generator fell back to templates

**Bad (generic):** "You're losing money to competitors"  
**Good (specific):** "Steven Krieger has 308 Google reviews. You have 5. When someone searches 'litigation attorney McLean' at 9pm, Google sees those numbers and picks them."

### What Was Fixed Today

#### 1. Report Generator v8 - Content Density
**File:** `automation/report-generator-v8.js`

**Changes:**
- Rebuilt with PROPER content density (1,349 words vs 600)
- Painful, specific hero using research data
- All 3 gaps with teaching moments (150-200 words each)
- Gap 3: Voice AI with contrast box ("Right now" vs "With infrastructure")
- "What We See" market analysis section
- Data-driven competitor insights
- No false claims (only uses review comparison if data exists)

**Hero Examples:**
- If has review data: "Steven Krieger has 308 reviews. You have 5."
- If no review data: "When someone searches 'litigation McLean, VA' at 9pm, they see 3 ads. None are yours."
- Validates all data before using it

#### 2. Research Script - Accepts Instantly Fields
**File:** `automation/research-v3-DEEP.js`

**Changes:**
- Now accepts: url, contactName, city, state, country, company
- Uses Instantly location as PRIMARY (scraping is fallback)
- **MAJOR:** Looks up firm's OWN Google Business Profile (not just competitors)
  - Gets: reviewCount, rating, googleBusinessAddress
- Validates location data with confidence scoring
- Analyzes multiple pages (homepage, about, contact)
- Cross-validates data sources

**Workflow updated:** `.github/workflows/process-interested-lead.yml`
- Extracts ALL fields from Instantly webhook
- Passes them to research script

#### 3. Hero Bug Fixes
**Problems found:**
- Was claiming "You have 0 reviews" when reviewCount was null (no data)
- Was showing "litigation Lean" (broken city name)

**Fixes:**
- Only use review comparison if `typeof reviewCount === 'number'`
- Validate location before using in hero
- Fall back to other comparisons if data missing

### Current Status

#### Working Version (Committed):
```
Research Script:
- ✅ Accepts Instantly fields
- ✅ Looks up firm's Google Business Profile (5 reviews, 5⭐)
- ✅ Validates location (McLean, VA)
- ✅ Finds 12 competitors
- ✅ Analyzes 3 pages
- ❌ Attorneys: 0 found (team page patterns too strict)
- ⚠️  Overall confidence: 4/10 (too low)

Report Generator v8:
- ✅ Content density (1,349 words)
- ✅ All 3 gaps with teaching moments
- ✅ Painful hero with validated data
- ✅ "What We See" section
- ✅ No false claims
```

#### Autonomous Version (Built, Needs Debug):
**File:** `automation/research-v3-DEEP.js` (branch: autonomous)

Sub-agent built version with 6+ fallback strategies:
- Location detection: 6 strategies (Google Business, AI, scraping, meta tags, schema.org, cross-validation)
- Team page discovery: 6 strategies (strict patterns, loose patterns, sitemap search, AI navigation, footer links, deep crawl)
- Attorney extraction: 4 strategies (regex, structured HTML, AI, JSON-LD)
- Retry logic on all network calls
- Cross-validation between sources

**Issue:** Hangs on browser launch (needs debugging)

### Data Quality Requirements Documented

**File:** `automation/DATA-PIPELINE-REQUIREMENTS.md`

Critical data AI needs:
1. Firm's OWN Google Business Profile (reviews, rating, address)
2. Correct location (validated, not "Lean" when it's "McLean")
3. Attorneys (names, titles, bios, credentials)
4. Multiple pages analyzed (About, Team, Contact)
5. Detailed competitor data
6. Practice area focus
7. Awards, credentials

Success criteria:
- ✅ Use ACTUAL firm name (not "Home")
- ✅ Use ACTUAL location (McLean, not Lean)
- ✅ Compare to ACTUAL competitors by name
- ✅ Use ACTUAL review counts (5 vs 308, not "0 vs many")
- ✅ Reference ACTUAL practice areas (TCPA, not "litigation")
- ✅ Include ACTUAL attorneys (if found)
- ✅ Confidence scores ≥7/10 for all key data

**Never fabricate data. Never sacrifice accuracy for speed.**

### Test Results: Roth Jackson (rothjackson.com)

**Research output:**
```json
{
  "firmName": "Roth Jackson",
  "location": { "city": "McLean", "state": "VA" },
  "locationSource": "instantly-unvalidated",
  "locationConfidence": 6,
  "reviewCount": 5,
  "rating": 5,
  "googleBusinessAddress": "8200 Greensboro Dr #820, McLean, VA 22102, USA",
  "practiceAreas": 16,
  "competitors": 12,
  "attorneys": 0,  ← PROBLEM
  "pagesAnalyzed": 3,
  "estimatedMonthlyRevenueLoss": 51000,
  "dataQuality": {
    "confidence": {
      "firmName": 10,
      "location": 6,
      "attorneys": 0,  ← PROBLEM
      "practiceAreas": 9,
      "overall": 4  ← TOO LOW
    },
    "warnings": [
      "No Team page found",
      "Missing key pages: team, testimonials",
      "No LinkedIn profile found for Andrew Condlin"
    ]
  }
}
```

**Report generated:**
- Hero: "When someone searches 'litigation McLean, VA' at 9pm, they see 3 ads. None are yours."
- Location: Correct (McLean, not Lean)
- Revenue loss: $51K/month
- Gaps: 5 found (Google Ads, Meta Ads, Voice AI, Website Speed, CRM)

### Issues Still to Fix

1. **Attorney Extraction (CRITICAL):**
   - Current: 0 attorneys found
   - Reason: Team page patterns too strict (`/team/?$`)
   - Misses: `/about/team/`, `/our-attorneys/`, `/people/`
   - Solution: Implement looser patterns + fallback strategies from autonomous version

2. **Data Confidence (CRITICAL):**
   - Overall: 4/10 (too low)
   - Need: ≥7/10 for all key fields
   - Blocking: Missing attorneys, low location validation

3. **Location Validation:**
   - OpenCage API returning confidence: 0 (rate limit?)
   - Falls back to Instantly data (confidence: 6)
   - Should try backup geocoding APIs

### Next Steps

1. Fix attorney extraction in working version:
   - Add loose URL patterns (allow subdirectories)
   - Search sitemap for team-related URLs
   - Try multiple page patterns before giving up

2. Improve data confidence:
   - Add backup geocoding API
   - Extract more from About/Team pages
   - Cross-validate more sources

3. Test end-to-end:
   - Trigger real Instantly lead
   - Verify all data flows through
   - Check report has specific, accurate content

### Files Modified Today

```
.github/workflows/process-interested-lead.yml
- Added city, state, country, company extraction from Instantly
- Passes all fields to research script

automation/research-v3-DEEP.js
- Accepts CLI params: url, contactName, city, state, country, company
- Looks up firm's Google Business Profile
- Validates location data
- Confidence scoring
- Data quality warnings

automation/report-generator-v8.js
- Content density rebuild (1,349 words)
- 3 gaps with teaching moments
- Painful hero with data validation
- "What We See" section
- No false claims

automation/DATA-PIPELINE-REQUIREMENTS.md (NEW)
- Documents what AI needs
- Success criteria
- Pipeline flow
- Data quality requirements
```

### Important Context

**Instantly Webhook Fields Available:**
- email
- first_name
- last_name
- email_id
- website
- city
- state
- country
- company

**User's Expectations:**
- "We need to make sure the AI gets as much ammo for the report"
- "Actually use deep research and AI to handle it"
- "Stop being dumb and lazy"
- "Don't focus too much on time, we want it to be the best report possible"
- "We need autonomy where it does its best and looks everywhere"
- "If data isn't grabbed from Instantly, do a thorough search to find it, not just skip or give bad data"

**Key Philosophy:**
- Accuracy > Speed
- Never fabricate data
- Try 6+ strategies before marking as "unknown"
- Rich data = Personalized insights = Better conversions

### Commits Today

```
70a9fc9 - MAJOR: Deep research overhaul - accepts Instantly fields, looks up firm's Google Business Profile
0626212 - Fix hero bugs: no false review claims, validate data before use
4511b22 - Workflow: accept and pass ALL Instantly fields to research script
5219c47 - Fix firm name extraction: reject generic titles, use domain as fallback
facd2ca - Merge v7 design into v8: Fraunces/Outfit fonts, cream/slate colors
260873b - Update v8 generator with complete pull design implementation
13057f9 - Rebuild v8 with content density: painful hero, 3 full gaps, What We See section
1856711 - [Various fixes and improvements]
36019a6 - WIP: Autonomous research with 6+ fallback strategies (needs debugging)
9a6701f - Add data pipeline requirements doc
```

### Remember

The report generator is only as good as the research data.
Without attorneys, AI can't personalize.
Without accurate location, competitor comparisons are wrong.
Without review counts, hero comparisons are generic.

**Focus:** Get attorney extraction working so AI has rich data to analyze.
